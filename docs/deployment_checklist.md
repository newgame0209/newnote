# デプロイ前チェックリスト

## 一般設定

- [x] 環境変数の設定確認
  - [x] フロントエンド: Firebase認証関連の環境変数
  - [x] バックエンド: Firebase Admin SDK関連の環境変数
- [x] CORSの設定を更新
  - [x] 許可オリジンを環境変数から取得するように変更
- [x] 本番環境のAPI URLを正しく設定
  - [x] `.env.production`にAPIのURLを設定済み

## フロントエンド（Vercel）

- [ ] ビルドコマンドの確認
  - [ ] `npm run build`
- [ ] `vercel.json`の設定確認
  - [x] SPA用リダイレクト設定あり
- [ ] 環境変数の設定
  - [x] Firebase関連の環境変数設定済み
  - [x] API URLの設定済み

## バックエンド（Render）

- [ ] `render.yaml`の設定確認
  - [x] 正しいビルドコマンドとスタートコマンド
  - [x] 環境変数設定あり
- [ ] Gunicornの設定確認
  - [x] `wsgi.py`ファイル存在確認
- [x] ヘルスチェックエンドポイントの実装
  - [x] `/health`エンドポイント追加済み

## API関連

- [x] 認証トークンの検証が正しく行われているか
  - [x] `auth_middleware.py`で実装済み
- [x] API URLが環境に応じて正しく切り替わるか
  - [x] フロントエンドの環境変数で設定済み
- [x] APIエラーハンドリングが正しく実装されているか
  - [x] エラーレスポンスにステータスコードと詳細が含まれている

## データベース

- [x] 本番環境のデータベース設定（SQLite）
  - [x] 永続ストレージマウント設定の確認
- [x] ユーザーIDが正しく関連付けされているか
  - [x] データアクセス制御が実装済み

## セキュリティ

- [x] 機密情報（API Key等）が直接コードに記載されていないか
  - [x] 環境変数経由で参照されている
- [x] リクエスト/レスポンスのバリデーションが行われているか
  - [x] 不正なリクエストに対してエラーレスポンスが返される

## その他

- [ ] デプロイ後の動作確認手順
  1. ユーザー登録・ログイン機能
  2. ノート作成・編集・削除
  3. OCR機能とTTS機能
  4. ブックマーク機能

## デプロイ後の修正が必要になる可能性が高い問題

1. CORSエラー
   - 対処法: バックエンドの`CORS_ORIGINS`環境変数に正しいフロントエンドURLを追加

2. 認証関連のエラー
   - 対処法: Firebaseプロジェクト設定で承認済みドメインを追加

3. API URLの不一致
   - 対処法: フロントエンドの環境変数を確認・修正

4. データベース接続エラー
   - 対処法: 環境変数`DATABASE_URL`の値を確認 